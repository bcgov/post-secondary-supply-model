---
title: "Module 03 - Technical Documentation"
format:
  html:
    toc: true
    toc-location: right
    toc-depth: 3
    number-sections: true
    number-depth: 3
    theme: cerulean
    code-fold: true
    grid: 
        body-width: 1800px
        sidebar-width: 100px
        margin-width: 300px
    css: styles.css
    html-math-method: katex
    self-contained: true
---

## Overview

This script computes the ratio of near completers to graduates by age group and credential.  Near completers who later received a credential according to the STP Credential file, or had an earlier credential are subtracted from the total of all near completers. 

Annual ratios are computed for all available years and an average taken of two or three representative years (chosen by investigation).  PSSM model 2023 used an average ratio of 2018-2019. 


## Data Sources and Storage

### External Data Sources 

#### STP Credential Data

Source: Provided from Ministry of Post-Secondary Education and Future Skills [?]
Source and Access Method: Generated in Module 02 from STP Credential Data.  Tables should be in the current R environment or linked via ODBC link to database
Description: STP Credential years searched: 2002/03 - 2022/23

### Internal/Processed Data Sources

#### credential_non_dup

Source and Access Method: Generated in Module 02 from STP Credential Data.  Tables should be in the current R environment or linked via ODBC link to database
Description: STP Credential years searched: 2002/03 - 2022/23

#### t_dacso_data_part_1

Source and Access Method: Contact Student Outcomes Team
Description: 
- Outcomes Survey cohorts Survey years: 2018, 2019, 2020, 2021, 2022, 2023 
- Credentials: Diploma, Associate Degree, and Certificate 
- Age groups: 17 to 19, 20 to 24, 25 to 29, and 35 to 64.  Using age at grad (not age at survey) for age groupings.

#### tmp_tbl_age 

Source and Access Method: Contact Student Outcomes Team
Description: 

- longitudinal master-lookup of birthdates and survey exit dates. Used to derive the age filters (such as the 17–64 range) we in aggregated tables.
- Historically, new data was appended to prior model run's data.  For 2026, we can request the full range required, SQL queries saved on the LAN for convenience.

### Data Storage Structure

Where data is housed in internal storage locations, it is stored in a hierarchical folder structure accessible via read_csv().

```
[BASE_FOLDER]/
├── data/
    ├── student-outcomes/  
    └── csv/            
        └── so-provision/ # provided by Student Outcomes
├── development/
    ├── csv/  
    └── gh-source/ # temporary storage for lookups and etc.         

└── outputs/
    ├── tables/          # Final output tables  
    └── visuals/         # Maps and visualizations
```

## Technical Specifications

### Dependencies and Environment Requirements

#### System Requirements

- Network Access: Secure LAN
- Database Connection: Project database connection - SQL Server
- Storage: [Note storage requirements]
- External Data: [List any required external data]

#### R Package Dependencies

The following R packages are required for this module:

- `tidyverse` (data manipulation and cleaning)
- `DBI` (to connect to database)
- `odbc` (to connect to database)
- `config` (to connect to database)


#### Authentication Setup

To connect to SQL Servers, we require a configuration file to connect securely to various required databases, and use `config` to read in the configuration.

```r
library(DBI)
library(odbc)
library(config)

# get configuration from config file 
db_config <- config::get("decimal")

# connect to database
con <- dbConnect(odbc(),
                 Driver = db_config$driver,
                 Server = db_config$server,
                 Database = db_config$database,
                 Trusted_Connection = "True")

# pull data from database 
strSQL <- "SELECT * FROM <table>.<name>"
df <- dbGetQuery(con, strSQL)
```


## Methodology Overview

##### Demographic Attribute Normalization and Age Derivation

Student temporal markers are standardized by normalizing date formats and consolidating annual records into a longitudinal master repository. The student age at graduation is derived by comparing birth dates to administrative exit dates; these data are then joined to the primary dataset to facilitate the mandatory cohort eligibility filtering ($17 \le x \le 64$) required for provincial reporting.

##### Cohort Baseline and Longitudinal Analysis

A unique subset of student records is used to establish a longitudinal baseline for cohort distribution analysis; the primary dataset is deduplicated and age-eligibility filters are applied ($17 \le x \le 64$). 

A frequency matrix that cross-tabulates graduation status against submission years is generated to **quantify** the statistical relationship between graduates and non-completers across multiple reporting cycles. These historical ratios help identify significant deviations in the data trend—such as the artificial variances introduced during the COVID-19 pandemic—and allow for the normalization of the cohort before final status reclassification.

##### Multi-Criteria Match Validation and Linkage

The primary relational linkage between survey respondents and provincial record systems is achieved using the Personal Education Number (PEN) as the unique identifier. This process integrates verified institutional credentials with the DACSO dataset and applies a standardized lookup to normalize program credential names for consistent reporting across the cohort.

Four primary criteria are used to validate that the provincial credential record aligns with the survey respondent's profile: 

* **Credential Type**
* **Program of Study (CIP code)**
* **Temporal Alignment (School Year)**
* **Institutional Identity**

A record is confirmed as a verified match if it satisfies **all four** criteria. Alternatively, if the specific 4-digit program code is missing but the high-level area of study (CIP-2) and the other three criteria match, the record is accepted to account for minor reporting variances in program classification.

##### Credential Promotion (Reclassification)

Verified records are partitioned into two discrete temporal windows based on the survey reporting cycle. Credentials awarded within or prior to the survey reporting cycle ($Year_{Award} \le Year_{Survey} + 1998$) are classified as "Before" awards, while those occurring subsequently are classified as "After" awards. This stratification ensures that the reclassification logic accounts for the timing of the award relative to the survey period.

A deterministic tie-breaking protocol is applied to students possessing multiple provincial credentials. The methodology prioritizes the most recent administrative record by selecting the credential with the maximum award year. In instances where multiple awards exist within the same award year, the record with the highest internal identifier ($ID$) is selected to ensure that each "Near-Completer" is reconciled against a singular, authoritative provincial record.

Finally, subjects originally classified as "Near-Completers" (Status 3) who possess a verified provincial credential are "promoted" to "Graduate" status (Status 1). This reclassification synthesizes survey-level observations with administrative data, producing the `grad_status_factoring_in_stp` attribute, which serves as the terminal variable for provincial longitudinal success reporting.

##### col H in Excel sheet

Raw respondent data is transformed into a structured frequency distribution of program classification (CIP-4) by age-based cohort.
The "Near-Completer" population ($Status = 3$) is extracted from survey reporting cycles, specifically Outcome 19 and Outcome 20. Individual records are binned by categorical age bins where the respondent's age at graduation satisfies boundary conditions specified in the table `AgeGroupLookup`. The resulting table serves as a primary frequency matrix, cross-tabulating age groups with specific institutional credentials and 4-digit Classification of Instructional Programs (CIP) codes. 

A secondary reclassification is done to ensure categorical alignment within the PSSM 2017-18 reporting framework. The  `combine_creds` mapping table is used to reconcile institutional credential names into standardized categories. Only those categories verified for the PSSM 2017-18 model are included in the final output; granular records are collapsed into higher-level taxonomic buckets, and a frequency count is computed for each unique intersection of variables.

##### 


#### Data Dictionary 

##### tbl_age

<ul class="list-variable-names">
<li>Age (Integer): </li>
<li>Age_Group (Integer): </li>
</ul>

##### t_pssm_projection_cred_grp

<ul class="list-variable-names">
<li>PSSM_Projection_Credential (String): </li>
<li>PSSM_Credential (String): </li>
<li>PSSM_Credential_Name (String): </li>
<li>COSC_GRAD_STATUS_LGDS_CD (Integer): </li>
</ul>

##### combine_creds

<ul class="list-variable-names">
<li>sort_order (Integer): </li>
<li>credential_code (String): </li>
<li>credential_name (String): </li>
<li>reporting_category (String): </li>
<li>is_active (String): </li>
</ul>

##### stp_dacso_prgrm_credential_lookup

<ul class="list-variable-names">
<li>PRGRM_Credential_Awarded (String): </li>
<li>PRGM_Credential_Awarded_Name (String): </li>
<li>STP_PRGM_Credential_Awarded_Name (String): </li>
</ul>

##### age_group_lookup

<ul class="list-variable-names">
<li>AgeIndex (Integer): </li>
<li>AgeGroup (String): </li>
<li>LowerBound (Integer): </li>
<li>UpperBound (Integer): </li>
</ul>

## Key Output Tables

## Suggested Improvements

## Additional Details